<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä¸Šæµ·è´­æˆ¿ vs ç§Ÿæˆ¿ Â· æ™ºèƒ½æ”¿ç­–ç‰ˆ</title>
  <style>
    body { font-family: "Microsoft YaHei", sans-serif; max-width: 950px; margin: 0 auto; padding: 20px; background: #f8f9fa; }
    .section { background: white; padding: 16px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    h1, h2 { color: #1a365d; }
    label { display: inline-block; width: 240px; margin-top: 8px; }
    input, select { width: 130px; padding: 6px; margin-left: 10px; }
    button { background: #2c7be5; color: white; border: none; padding: 10px 24px; margin-top: 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
    button:hover { background: #1a5fb4; }
    .result { margin-top: 20px; padding: 16px; background: #eef7ff; border-left: 5px solid #2c7be5; }
    .alert { background: #fff3cd; color: #856404; padding: 12px; border-radius: 6px; margin: 10px 0; }
    .error { background: #f8d7da; color: #721c24; }
    .success { background: #d4edda; color: #155724; }
    .highlight { font-weight: bold; color: #d32f2f; }
    details { margin-top: 15px; }
    summary { cursor: pointer; font-weight: bold; color: #1a73e8; }
  </style>
</head>
<body>

<h1>ğŸ  ä¸Šæµ·è´­æˆ¿ vs ç§Ÿæˆ¿ Â· æ™ºèƒ½æ”¿ç­–åˆè§„ç‰ˆï¼ˆ2026ï¼‰</h1>

<div class="section">
  <h2>1. è´­æˆ¿è€…èº«ä»½ä¿¡æ¯</h2>
  <label>æˆ·ç±ç±»å‹ï¼š</label>
  <select id="hukou">
    <option value="shanghai">ä¸Šæµ·æˆ·ç±</option>
    <option value="non-shanghai">éä¸Šæµ·æˆ·ç±</option>
  </select><br>

  <label>å®¶åº­ç»“æ„ï¼š</label>
  <select id="familyType">
    <option value="family">å·²å©š/å®¶åº­</option>
    <option value="single">å•èº«ï¼ˆå«æœªå©šã€ç¦»å¼‚ã€ä¸§å¶ï¼‰</option>
  </select><br>

  <label>æ˜¯å¦å¤šå­å¥³å®¶åº­ï¼š</label>
  <select id="multiChild">
    <option value="no">å¦</option>
    <option value="yes">æ˜¯ï¼ˆäºŒå­©åŠä»¥ä¸Šï¼‰</option>
  </select><br>

  <label>å½“å‰åä¸‹ä½æˆ¿å¥—æ•°ï¼š</label>
  <select id="ownedHouses">
    <option value="0">0å¥—ï¼ˆé¦–å¥—ï¼‰</option>
    <option value="1">1å¥—ï¼ˆäºŒå¥—ï¼‰</option>
    <option value="2+">2å¥—åŠä»¥ä¸Š</option>
  </select><br>

  <label>éæ²ªç±ï¼šç¤¾ä¿/ä¸ªç¨ç¼´çº³å¹´é™ï¼ˆå¹´ï¼‰ï¼š</label>
  <input type="number" id="socialYears" value="3" min="0" step="0.5">
</div>

<div class="section">
  <h2>2. ç›®æ ‡æˆ¿äº§ä¿¡æ¯</h2>
  <label>æˆ¿å±‹æ€»ä»·ï¼ˆå…ƒï¼‰ï¼š</label><input type="number" id="housePrice" value="6000000"><br>
  <label>å»ºç­‘é¢ç§¯ï¼ˆã¡ï¼‰ï¼š</label><input type="number" id="area" value="100" step="0.1"><br>
  <label>æ‰€åœ¨åŒºåŸŸï¼š</label>
  <select id="ring">
    <option value="inner">å†…ç¯å†…</option>
    <option value="middle">ä¸­å¤–ç¯é—´</option>
    <option value="outer">å¤–ç¯å¤–</option>
  </select><br>
  <label>æ˜¯å¦æ–°æˆ¿ï¼ˆå½±å“å…¬ç§¯é‡‘â€œåˆæåˆè´·â€ï¼‰ï¼š</label>
  <select id="isNew">
    <option value="yes">æ˜¯ï¼ˆæ–°å»ºå•†å“æˆ¿ï¼‰</option>
    <option value="no">å¦ï¼ˆäºŒæ‰‹æˆ¿ï¼‰</option>
  </select>
</div>

<div class="section">
  <h2>3. ä½ çš„èµ„é‡‘æƒ…å†µ</h2>
  <label>ç°é‡‘å­˜æ¬¾ï¼ˆå…ƒï¼‰ï¼š</label><input type="number" id="cash" value="200000"><br>
  <label>è‚¡ç¥¨å¸‚å€¼ï¼ˆå…ƒï¼‰ï¼š</label><input type="number" id="stock" value="300000"><br>
  <label>è‚¡ç¥¨å¹´åŒ–æ”¶ç›Šï¼ˆ%ï¼‰ï¼š</label><input type="number" id="stockReturn" value="5" step="0.1"><br>
  <label>å…¬ç§¯é‡‘è´¦æˆ·ä½™é¢ï¼ˆå…ƒï¼‰ï¼š</label><input type="number" id="gjjBalance" value="100000"><br>
  <label>æœˆç¼´å­˜å…¬ç§¯é‡‘æ€»é¢ï¼ˆå…ƒï¼‰ï¼š</label><input type="number" id="gjjMonthly" value="3000">
</div>

<div class="section">
  <h2>4. ç§Ÿæˆ¿å‡è®¾ & åˆ†æå¹´é™</h2>
  <label>å½“å‰æœˆç§Ÿé‡‘ï¼ˆå…ƒï¼‰ï¼š</label><input type="number" id="rent" value="8000"><br>
  <label>ç§Ÿé‡‘å¹´æ¶¨å¹…ï¼ˆ%ï¼‰ï¼š</label><input type="number" id="rentGrowth" value="3" step="0.1"><br>
  <label>åˆ†æå¹´é™ï¼ˆå¹´ï¼‰ï¼š</label><input type="number" id="years" value="10" min="1" max="30">
</div>

<button onclick="runAnalysis()">ğŸ” æ™ºèƒ½åˆ†æï¼ˆè‡ªåŠ¨é€‚é…ä¸Šæµ·æœ€æ–°æ”¿ç­–ï¼‰</button>

<div id="policyAlert" style="display:none;" class="alert"></div>
<div id="result" class="result" style="display:none;"></div>

<script>
function runAnalysis() {
  // ===== 1. è·å–ç”¨æˆ·è¾“å…¥ =====
  const hukou = document.getElementById('hukou').value;
  const familyType = document.getElementById('familyType').value;
  const multiChild = document.getElementById('multiChild').value === 'yes';
  const ownedHouses = parseInt(document.getElementById('ownedHouses').value);
  const socialYears = parseFloat(document.getElementById('socialYears').value) || 0;
  const housePrice = parseFloat(document.getElementById('housePrice').value) || 0;
  const area = parseFloat(document.getElementById('area').value) || 0;
  const ring = document.getElementById('ring').value;
  const isNew = document.getElementById('isNew').value === 'yes';
  const cash = parseFloat(document.getElementById('cash').value) || 0;
  const stock = parseFloat(document.getElementById('stock').value) || 0;
  const stockReturn = parseFloat(document.getElementById('stockReturn').value) / 100;
  const gjjBalance = parseFloat(document.getElementById('gjjBalance').value) || 0;
  const gjjMonthly = parseFloat(document.getElementById('gjjMonthly').value) || 0;
  const rent = parseFloat(document.getElementById('rent').value) || 0;
  const rentGrowth = parseFloat(document.getElementById('rentGrowth').value) / 100;
  const years = parseInt(document.getElementById('years').value) || 10;

  // ===== 2. åˆ¤æ–­æ˜¯å¦æ™®é€šä½å®… =====
  let priceLimit = 0;
  if (ring === 'inner') priceLimit = 7800000;
  else if (ring === 'middle') priceLimit = 6600000;
  else priceLimit = 4800000;

  const isOrdinary = (housePrice <= priceLimit) && (area <= 140);

  // ===== 3. è´­æˆ¿èµ„æ ¼æ ¡éªŒ =====
  let qualified = true;
  let disqualifyReason = '';

  if (hukou === 'non-shanghai') {
    if (ring !== 'outer') {
      if (socialYears < 3) {
        qualified = false;
        disqualifyReason = 'éæ²ªç±è´­ä¹°å†…ç¯æˆ–ä¸­å¤–ç¯æˆ¿äº§éœ€è¿ç»­ç¼´çº³ç¤¾ä¿æ»¡3å¹´ã€‚';
      }
    } else {
      if (socialYears < 1) {
        qualified = false;
        disqualifyReason = 'éæ²ªç±è´­ä¹°å¤–ç¯å¤–æˆ¿äº§éœ€ç¤¾ä¿æ»¡1å¹´ã€‚';
      }
    }
  }

  // å•èº«é™è´­ï¼ˆå†…ç¯/ä¸­å¤–ç¯ï¼‰
  if (familyType === 'single' && ring !== 'outer' && hukou === 'shanghai') {
    if (ownedHouses >= 1) {
      qualified = false;
      disqualifyReason = 'æ²ªç±å•èº«åœ¨å†…ç¯/ä¸­å¤–ç¯é™è´­1å¥—ï¼Œæ‚¨å·²æœ‰ä½æˆ¿ã€‚';
    }
  }

  // æ˜¾ç¤ºèµ„æ ¼çŠ¶æ€
  const alertDiv = document.getElementById('policyAlert');
  if (!qualified) {
    alertDiv.className = 'alert error';
    alertDiv.innerText = 'âŒ è´­æˆ¿èµ„æ ¼ä¸ç¬¦ï¼š' + disqualifyReason;
    alertDiv.style.display = 'block';
    document.getElementById('result').style.display = 'none';
    return;
  } else {
    alertDiv.className = 'alert success';
    alertDiv.innerText = 'âœ… ç¬¦åˆä¸Šæµ·è´­æˆ¿èµ„æ ¼ï¼';
    alertDiv.style.display = 'block';
  }

  // ===== 4. é¦–ä»˜æ¯”ä¾‹ =====
  let downPaymentRate = 0.35; // é»˜è®¤
  const isFirstHome = ownedHouses === 0;

  if (isFirstHome) {
    downPaymentRate = isOrdinary ? 0.20 : 0.35;
  } else if (ownedHouses === 1) {
    downPaymentRate = isOrdinary ? 0.35 : 0.70;
  } else {
    downPaymentRate = 0.70; // ä¸‰å¥—åŠä»¥ä¸ŠåŸºæœ¬åœè´·
  }

  // ===== 5. å…¬ç§¯é‡‘è´·æ¬¾é¢åº¦ =====
  let gjjMax = 1400000; // å®¶åº­é»˜è®¤
  if (familyType === 'single') gjjMax = 700000;
  if (multiChild) gjjMax = 2160000;

  // å¯è´·é¢åº¦å—ä½™é¢é™åˆ¶ï¼šä½™é¢ Ã— 40ï¼ˆä¸Šæµ·å€æ•°ï¼‰
  const gjjLoanByBalance = gjjBalance * 40;
  let actualGjjLoan = Math.min(gjjMax, gjjLoanByBalance, housePrice * (1 - downPaymentRate));

  // è‹¥å¤–ç¯å¤–æ–°æˆ¿ï¼Œå¯â€œåˆæåˆè´·â€ï¼Œä½†ä¸å½±å“è´·æ¬¾é¢ï¼Œä»…å½±å“é¦–ä»˜æ¥æº

  // ===== 6. å•†ä¸šè´·æ¬¾ =====
  const totalLoanNeeded = housePrice * (1 - downPaymentRate);
  const commercialLoan = Math.max(0, totalLoanNeeded - actualGjjLoan);

  // åˆ©ç‡ï¼ˆ2026å¹´å•†è´·é¦–å¥—äºŒå¥—ç»Ÿä¸€ï¼Œä½†å…¬ç§¯é‡‘åŒºåˆ†ï¼‰
  const commercialRate = 0.035; // å‡è®¾3.5%
  const gjjRate = isFirstHome ? 0.0285 : 0.03325;

  // ===== 7. æœˆä¾›è®¡ç®— =====
  function calcMonthlyPayment(principal, annualRate, years) {
    if (principal <= 0) return 0;
    const r = annualRate / 12;
    const n = years * 12;
    return (principal * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
  }

  const gjjMonthlyPayment = calcMonthlyPayment(actualGjjLoan, gjjRate, 30);
  const commercialMonthlyPayment = calcMonthlyPayment(commercialLoan, commercialRate, 30);
  const totalMonthlyPayment = gjjMonthlyPayment + commercialMonthlyPayment;

  // ===== 8. ç¨è´¹ =====
  // å¥‘ç¨
  let deedTaxRate = 0.03; // é»˜è®¤ä¸‰å¥—
  if (isFirstHome) {
    deedTaxRate = area <= 90 ? 0.01 : 0.015;
  } else if (ownedHouses === 1) {
    deedTaxRate = area <= 90 ? 0.01 : 0.02;
  }
  const deedTax = housePrice * deedTaxRate;

  // ä¸­ä»‹è´¹ï¼ˆå‡è®¾2%ï¼‰
  const agentFee = housePrice * 0.02;
  // ç»´ä¿®åŸºé‡‘ï¼ˆå‡è®¾100å…ƒ/ã¡ï¼‰
  const maintenanceFund = area * 100;
  // è£…ä¿®ï¼ˆä¼°ç®—ï¼‰
  const renovation = housePrice * 0.05; // 5%

  const oneTimeCost = housePrice * downPaymentRate + deedTax + agentFee + maintenanceFund + renovation;

  // ===== 9. å¹´æŒæœ‰æˆæœ¬ =====
  const propertyFee = 5; // å…ƒ/ã¡/æœˆ
  const annualProperty = propertyFee * area * 12;

  // æˆ¿äº§ç¨ï¼ˆç®€åŒ–ï¼šè‹¥ä¸ç¬¦åˆå…ç¨æ¡ä»¶åˆ™ä¼°ç®—ï¼‰
  let annualPropertyTax = 0;
  // æ­¤å¤„ç®€åŒ–ï¼šå‡è®¾é¦–å¥—å‡å…ç¨ï¼ˆå› éæ²ªç±æ»¡3å¹´æˆ–æ²ªç±ï¼‰
  // å¦‚éœ€ç²¾ç¡®ï¼Œå¯æ‰©å±•äººå‡é¢ç§¯é€»è¾‘

  const annualHousingCost = totalMonthlyPayment * 12 + annualProperty + annualPropertyTax;

  // ===== 10. è´­æˆ¿æ€»æˆæœ¬ï¼ˆå«æœºä¼šæˆæœ¬ï¼‰=====
  const housingCashOut = oneTimeCost + annualHousingCost * years;
  const investable = cash + stock + gjjBalance;
  const usedInOneTime = Math.min(investable, oneTimeCost);
  const opportunityCost = usedInOneTime * (Math.pow(1 + stockReturn, years) - 1);
  const buyTotal = housingCashOut + opportunityCost;

  // ===== 11. ç§Ÿæˆ¿æ€»æˆæœ¬ =====
  let rentTotal = 0;
  let r = rent;
  for (let i = 0; i < years; i++) {
    rentTotal += r * 12;
    r *= (1 + rentGrowth);
  }

  // ===== 12. è¾“å‡ºç»“æœ =====
  const diff = buyTotal - rentTotal;
  const recommendation = diff > 0 ? 'ç§Ÿæˆ¿æ›´çœ' : 'è´­æˆ¿æ›´çœ';

  let resultHTML = `
    <h3>ğŸ“Š åˆ†æç»“æœï¼ˆ${years}å¹´å‘¨æœŸï¼‰</h3>
    <p>ğŸ“ æˆ¿å±‹ç±»å‹ï¼š${isOrdinary ? 'æ™®é€šä½å®…' : 'éæ™®é€šä½å®…'} Â· ${ring === 'inner' ? 'å†…ç¯å†…' : ring === 'middle' ? 'ä¸­å¤–ç¯' : 'å¤–ç¯å¤–'}</p>
    <p>ğŸ’° <strong>è´­æˆ¿æ€»æˆæœ¬ï¼ˆå«æœºä¼šæˆæœ¬ï¼‰ï¼š</strong><span class="highlight">${Math.round(buyTotal).toLocaleString()}</span> å…ƒ</p>
    <p>ğŸ  <strong>ç§Ÿæˆ¿æ€»æ”¯å‡ºï¼š</strong><span class="highlight">${Math.round(rentTotal).toLocaleString()}</span> å…ƒ</p>
    <p>âš–ï¸ <strong>å·®é¢ï¼š</strong>${Math.round(diff).toLocaleString()} å…ƒï¼ˆ${recommendation}ï¼‰</p>
    
    <details><summary>ğŸ“ è´·æ¬¾ä¸ç¨è´¹æ˜ç»†</summary>
      <ul>
        <li>é¦–ä»˜æ¯”ä¾‹ï¼š${(downPaymentRate * 100).toFixed(0)}% â†’ ${Math.round(housePrice * downPaymentRate).toLocaleString()} å…ƒ</li>
        <li>å…¬ç§¯é‡‘è´·æ¬¾ï¼š${Math.round(actualGjjLoan).toLocaleString()} å…ƒï¼ˆåˆ©ç‡ ${(gjjRate * 100).toFixed(2)}%ï¼‰</li>
        <li>å•†ä¸šè´·æ¬¾ï¼š${Math.round(commercialLoan).toLocaleString()} å…ƒï¼ˆåˆ©ç‡ ${(commercialRate * 100).toFixed(2)}%ï¼‰</li>
        <li>æœˆä¾›åˆè®¡ï¼š${Math.round(totalMonthlyPayment).toLocaleString()} å…ƒ/æœˆ</li>
        <li>å¥‘ç¨ï¼š${Math.round(deedTax).toLocaleString()} å…ƒï¼ˆç¨ç‡ ${(deedTaxRate * 100).toFixed(1)}%ï¼‰</li>
        <li>ä¸­ä»‹è´¹ï¼š${Math.round(agentFee).toLocaleString()} å…ƒ</li>
        <li>è£…ä¿®ï¼ˆä¼°ç®—ï¼‰ï¼š${Math.round(renovation).toLocaleString()} å…ƒ</li>
        <li>ç‰©ä¸šè´¹ï¼ˆ${years}å¹´ï¼‰ï¼š${Math.round(annualProperty * years).toLocaleString()} å…ƒ</li>
      </ul>
    </details>
  `;

  document.getElementById('result').innerHTML = resultHTML;
  document.getElementById('result').style.display = 'block';
}
</script>

</body>
</html>